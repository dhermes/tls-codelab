

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>openssl Tooling &mdash; tls-codelab  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="_static/favicon.png"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Wireshark Tooling" href="wireshark.html" />
    <link rel="prev" title="Introduction" href="introduction.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> tls-codelab
          

          
          </a>

          
            
            
              <div class="version">
                a397c8ae
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#"><code class="docutils literal notranslate"><span class="pre">openssl</span></code> Tooling</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#checking-certificate-presented-by-server">Checking Certificate Presented by Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="#chain">Chain</a></li>
<li class="toctree-l2"><a class="reference internal" href="#leaf">Leaf</a></li>
<li class="toctree-l2"><a class="reference internal" href="#intermediate">Intermediate</a></li>
<li class="toctree-l2"><a class="reference internal" href="#root">Root</a></li>
<li class="toctree-l2"><a class="reference internal" href="#links-in-the-chain">Links in the Chain</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="wireshark.html">Wireshark Tooling</a></li>
<li class="toctree-l1"><a class="reference internal" href="trust.html">Trust</a></li>
<li class="toctree-l1"><a class="reference internal" href="problems.html">Common Reasons to Debug TLS</a></li>
<li class="toctree-l1"><a class="reference internal" href="nodejs.html">Node.js</a></li>
<li class="toctree-l1"><a class="reference internal" href="mutual-tls.html">Mutual TLS</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendix/index.html">Appendix</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">tls-codelab</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li><code class="docutils literal notranslate"><span class="pre">openssl</span></code> Tooling</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            
              <a href="https://github.com/dhermes/tls-codelab/blob/a397c8ae732ab8e490998ef96269ce57362ad0a0/docs/openssl.md" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="openssl-tooling">
<h1><code class="docutils literal notranslate"><span class="pre">openssl</span></code> Tooling<a class="headerlink" href="#openssl-tooling" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#checking-certificate-presented-by-server" id="id1">Checking Certificate Presented by Server</a></p></li>
<li><p><a class="reference internal" href="#chain" id="id2">Chain</a></p></li>
<li><p><a class="reference internal" href="#leaf" id="id3">Leaf</a></p></li>
<li><p><a class="reference internal" href="#intermediate" id="id4">Intermediate</a></p></li>
<li><p><a class="reference internal" href="#root" id="id5">Root</a></p></li>
<li><p><a class="reference internal" href="#links-in-the-chain" id="id6">Links in the Chain</a></p></li>
</ul>
</div>
<div class="section" id="checking-certificate-presented-by-server">
<h2><a class="toc-backref" href="#id1">Checking Certificate Presented by Server</a><a class="headerlink" href="#checking-certificate-presented-by-server" title="Permalink to this headline">¶</a></h2>
<p>By invoking</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ openssl s_client -showcerts -connect github.com:443 -servername github.com
</pre></div>
</div>
<p>we can see a wealth of information about a given hostname (e.g. here
<code class="docutils literal notranslate"><span class="pre">github.com</span></code>)</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ openssl s_client -showcerts -connect github.com:443 -servername github.com
CONNECTED(00000005)
depth=2 C = US, O = DigiCert Inc, OU = www.digicert.com, CN = DigiCert High Assurance EV Root CA
verify return:1
depth=1 C = US, O = DigiCert Inc, OU = www.digicert.com, CN = DigiCert SHA2 High Assurance Server CA
verify return:1
depth=0 C = US, ST = California, L = San Francisco, O = &quot;GitHub, Inc.&quot;, CN = github.com
verify return:1
---
Certificate chain
 0 s:/C=US/ST=California/L=San Francisco/O=GitHub, Inc./CN=github.com
   i:/C=US/O=DigiCert Inc/OU=www.digicert.com/CN=DigiCert SHA2 High Assurance Server CA
-----BEGIN CERTIFICATE-----
MIIG1TCCBb2gAwIBAgIQBVfICygmg6F7ChFEkylreTANBgkqhkiG9w0BAQsFADBw
MQswCQYDVQQGEwJVUzEVMBMGA1UEChMMRGlnaUNlcnQgSW5jMRkwFwYDVQQLExB3
d3cuZGlnaWNlcnQuY29tMS8wLQYDVQQDEyZEaWdpQ2VydCBTSEEyIEhpZ2ggQXNz
dXJhbmNlIFNlcnZlciBDQTAeFw0yMDA1MDUwMDAwMDBaFw0yMjA1MTAxMjAwMDBa
MGYxCzAJBgNVBAYTAlVTMRMwEQYDVQQIEwpDYWxpZm9ybmlhMRYwFAYDVQQHEw1T
YW4gRnJhbmNpc2NvMRUwEwYDVQQKEwxHaXRIdWIsIEluYy4xEzARBgNVBAMTCmdp
dGh1Yi5jb20wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC7MrTQ2J6a
nox5KUwrqO9cQ9STO5R4/zBUxxvI5S8bmc0QjWfIVAwHWuT0Bn/H1oS0LM0tTkQm
ARrqN77v9McVB8MWTGsmGQnS/1kQRFuKiYGUHf7iX5pfijbYsOkfb4AiVKysKUNV
UtgVvpJoe5RWURjQp9XDWkeo2DzGHXLcBDadrM8VLC6H1/D9SXdVruxKqduLKR41
Z/6dlSDdeY1gCnhz3Ch1pYbfMfsTCTamw+AtRtwlK3b2rfTHffhowjuzM15UKt+b
rr/cEBlAjQTva8rutYU9K9ONgl+pG2u7Bv516DwmNy8xz9wOjTeOpeh0M9N/ewq8
cgbR87LFaxi1AgMBAAGjggNzMIIDbzAfBgNVHSMEGDAWgBRRaP+QrwIHdTzM2WVk
YqISuFlyOzAdBgNVHQ4EFgQUYwLSXQJf943VWhKedhE2loYsikgwJQYDVR0RBB4w
HIIKZ2l0aHViLmNvbYIOd3d3LmdpdGh1Yi5jb20wDgYDVR0PAQH/BAQDAgWgMB0G
A1UdJQQWMBQGCCsGAQUFBwMBBggrBgEFBQcDAjB1BgNVHR8EbjBsMDSgMqAwhi5o
dHRwOi8vY3JsMy5kaWdpY2VydC5jb20vc2hhMi1oYS1zZXJ2ZXItZzYuY3JsMDSg
MqAwhi5odHRwOi8vY3JsNC5kaWdpY2VydC5jb20vc2hhMi1oYS1zZXJ2ZXItZzYu
Y3JsMEwGA1UdIARFMEMwNwYJYIZIAYb9bAEBMCowKAYIKwYBBQUHAgEWHGh0dHBz
Oi8vd3d3LmRpZ2ljZXJ0LmNvbS9DUFMwCAYGZ4EMAQICMIGDBggrBgEFBQcBAQR3
MHUwJAYIKwYBBQUHMAGGGGh0dHA6Ly9vY3NwLmRpZ2ljZXJ0LmNvbTBNBggrBgEF
BQcwAoZBaHR0cDovL2NhY2VydHMuZGlnaWNlcnQuY29tL0RpZ2lDZXJ0U0hBMkhp
Z2hBc3N1cmFuY2VTZXJ2ZXJDQS5jcnQwDAYDVR0TAQH/BAIwADCCAXwGCisGAQQB
1nkCBAIEggFsBIIBaAFmAHUAKXm+8J45OSHwVnOfY6V35b5XfZxgCvj5TV0mXCVd
x4QAAAFx5ltprwAABAMARjBEAiAuWGCWxN/M0Ms3KOsqFjDMHT8Aq0SlHfQ68KDg
rVU6AAIgDA+2EB0D5W5r0i4Nhljx6ABlIByzrEdfcxiOD/o6//EAdQAiRUUHWVUk
VpY/oS/x922G4CMmY63AS39dxoNcbuIPAgAAAXHmW2nTAAAEAwBGMEQCIBp+XQKa
UDiPHwjBxdv5qvgyALKaysKqMF60gqem8iPRAiAk9Dp5+VBUXfSHqyW+tVShUigh
ndopccf8Gs21KJ4jXgB2AFGjsPX9AXmcVm24N3iPDKR6zBsny/eeiEKaDf7UiwXl
AAABceZbahsAAAQDAEcwRQIgd/5HcxT4wfNV8zavwxjYkw2TYBAuRCcqp1SjWKFn
4EoCIQDHSTHxnbpxWFbP6v5Y6nGFZCDjaHgd9HrzUv2J/DaacDANBgkqhkiG9w0B
AQsFAAOCAQEAhjKPnBW4r+jR3gg6RA5xICTW/A5YMcyqtK0c1QzFr8S7/l+skGpC
yCHrJfFrLDeyKqgabvLRT6YvvM862MGfMMDsk+sKWtzLbDIcYG7sbviGpU+gtG1q
B0ohWNApfWWKyNpquqvwdSEzAEBvhcUT5idzbK7q45bQU9vBIWgQz+PYULAU7KmY
z7jOYV09o22TNMQT+hFmo92+EBlwSeIETYEsHy5ZxixTRTvu9hP00CyEbiht5OTK
5EiJG6vsIh/uEtRsdenMCxV06W2f20Af4iSFo0uk6c1ryHefh08FcwA4pSNUaPyi
Pb8YGQ6o/blejFzo/OSiUnDueafSJ0p6SQ==
-----END CERTIFICATE-----
 1 s:/C=US/O=DigiCert Inc/OU=www.digicert.com/CN=DigiCert SHA2 High Assurance Server CA
   i:/C=US/O=DigiCert Inc/OU=www.digicert.com/CN=DigiCert High Assurance EV Root CA
-----BEGIN CERTIFICATE-----
MIIEsTCCA5mgAwIBAgIQBOHnpNxc8vNtwCtCuF0VnzANBgkqhkiG9w0BAQsFADBs
MQswCQYDVQQGEwJVUzEVMBMGA1UEChMMRGlnaUNlcnQgSW5jMRkwFwYDVQQLExB3
d3cuZGlnaWNlcnQuY29tMSswKQYDVQQDEyJEaWdpQ2VydCBIaWdoIEFzc3VyYW5j
ZSBFViBSb290IENBMB4XDTEzMTAyMjEyMDAwMFoXDTI4MTAyMjEyMDAwMFowcDEL
MAkGA1UEBhMCVVMxFTATBgNVBAoTDERpZ2lDZXJ0IEluYzEZMBcGA1UECxMQd3d3
LmRpZ2ljZXJ0LmNvbTEvMC0GA1UEAxMmRGlnaUNlcnQgU0hBMiBIaWdoIEFzc3Vy
YW5jZSBTZXJ2ZXIgQ0EwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC2
4C/CJAbIbQRf1+8KZAayfSImZRauQkCbztyfn3YHPsMwVYcZuU+UDlqUH1VWtMIC
Kq/QmO4LQNfE0DtyyBSe75CxEamu0si4QzrZCwvV1ZX1QK/IHe1NnF9Xt4ZQaJn1
itrSxwUfqJfJ3KSxgoQtxq2lnMcZgqaFD15EWCo3j/018QsIJzJa9buLnqS9UdAn
4t07QjOjBSjEuyjMmqwrIw14xnvmXnG3Sj4I+4G3FhahnSMSTeXXkgisdaScus0X
sh5ENWV/UyU50RwKmmMbGZJ0aAo3wsJSSMs5WqK24V3B3aAguCGikyZvFEohQcft
bZvySC/zA/WiaJJTL17jAgMBAAGjggFJMIIBRTASBgNVHRMBAf8ECDAGAQH/AgEA
MA4GA1UdDwEB/wQEAwIBhjAdBgNVHSUEFjAUBggrBgEFBQcDAQYIKwYBBQUHAwIw
NAYIKwYBBQUHAQEEKDAmMCQGCCsGAQUFBzABhhhodHRwOi8vb2NzcC5kaWdpY2Vy
dC5jb20wSwYDVR0fBEQwQjBAoD6gPIY6aHR0cDovL2NybDQuZGlnaWNlcnQuY29t
L0RpZ2lDZXJ0SGlnaEFzc3VyYW5jZUVWUm9vdENBLmNybDA9BgNVHSAENjA0MDIG
BFUdIAAwKjAoBggrBgEFBQcCARYcaHR0cHM6Ly93d3cuZGlnaWNlcnQuY29tL0NQ
UzAdBgNVHQ4EFgQUUWj/kK8CB3U8zNllZGKiErhZcjswHwYDVR0jBBgwFoAUsT7D
aQP4v0cB1JgmGggC72NkK8MwDQYJKoZIhvcNAQELBQADggEBABiKlYkD5m3fXPwd
aOpKj4PWUS+Na0QWnqxj9dJubISZi6qBcYRb7TROsLd5kinMLYBq8I4g4Xmk/gNH
E+r1hspZcX30BJZr01lYPf7TMSVcGDiEo+afgv2MW5gxTs14nhr9hctJqvIni5ly
/D6q1UEL2tU2ob8cbkdJf17ZSHwD2f2LSaCYJkJA69aSEaRkCldUxPUd1gJea6zu
xICaEnL6VpPX/78whQYwvwt/Tv9XBZ0k7YXDK/umdaisLRbvfXknsuvCnQsH6qqF
0wGjIChBWUMo0oHjqvbsezt3tkBigAVBRQHvFwY+3sAzm2fTYS5yh+Rp/BIAV0Ae
cPUeybQ=
-----END CERTIFICATE-----
---
Server certificate
subject=/C=US/ST=California/L=San Francisco/O=GitHub, Inc./CN=github.com
issuer=/C=US/O=DigiCert Inc/OU=www.digicert.com/CN=DigiCert SHA2 High Assurance Server CA
---
No client certificate CA names sent
Server Temp Key: ECDH, X25519, 253 bits
---
SSL handshake has read 3439 bytes and written 308 bytes
---
New, TLSv1/SSLv3, Cipher is ECDHE-RSA-AES128-GCM-SHA256
Server public key is 2048 bit
Secure Renegotiation IS supported
Compression: NONE
Expansion: NONE
No ALPN negotiated
SSL-Session:
    Protocol  : TLSv1.2
    Cipher    : ECDHE-RSA-AES128-GCM-SHA256
    Session-ID: 42E113D36022F96C0928D4F294DFFBF7066AD8F6D56EEB0BD7FEBA15E11CDDB8
    Session-ID-ctx:
    Master-Key: 976229BEF07105DD3C9E1EDCB4378FFBC564651B0C614D92EDC472F11955CF5EBB449DF1D380F4488219BE0F1EC24211
    Start Time: 1612538529
    Timeout   : 7200 (sec)
    Verify return code: 0 (ok)
---
closed
</pre></div>
</div>
</div>
<div class="section" id="chain">
<h2><a class="toc-backref" href="#id2">Chain</a><a class="headerlink" href="#chain" title="Permalink to this headline">¶</a></h2>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>depth=2 C = US, O = DigiCert Inc, OU = www.digicert.com, CN = DigiCert High Assurance EV Root CA
verify return:1
depth=1 C = US, O = DigiCert Inc, OU = www.digicert.com, CN = DigiCert SHA2 High Assurance Server CA
verify return:1
depth=0 C = US, ST = California, L = San Francisco, O = &quot;GitHub, Inc.&quot;, CN = github.com
verify return:1
</pre></div>
</div>
<p>The Common Name (<code class="docutils literal notranslate"><span class="pre">CN</span></code>) is what we see in Google Chrome as a brief description
of each certificate in the chain. The chain is composed of</p>
<ul class="simple">
<li><p>The leaf (or server) certificate, i.e. here it’s the <code class="docutils literal notranslate"><span class="pre">depth=0</span></code> certificate
with <code class="docutils literal notranslate"><span class="pre">CN</span> <span class="pre">=</span> <span class="pre">github.com</span></code>.</p></li>
<li><p>A series of 0 or more intermediate CA (certificate authority) certificates,
here the <code class="docutils literal notranslate"><span class="pre">depth=1</span></code> certificate with
<code class="docutils literal notranslate"><span class="pre">CN</span> <span class="pre">=</span> <span class="pre">DigiCert</span> <span class="pre">SHA2</span> <span class="pre">High</span> <span class="pre">Assurance</span> <span class="pre">Server</span> <span class="pre">CA</span></code>
is the <strong>only</strong> intermediate. (More on intermediates later.)</p></li>
<li><p>A <strong>root</strong> CA certificate, which should be the <strong>only</strong> part of the chain
trusted by the client (e.g. Google Chrome, <code class="docutils literal notranslate"><span class="pre">curl</span></code>, your code, etc.).
Here it’s the <code class="docutils literal notranslate"><span class="pre">depth=2</span></code> certificate with
<code class="docutils literal notranslate"><span class="pre">CN</span> <span class="pre">=</span> <span class="pre">DigiCert</span> <span class="pre">High</span> <span class="pre">Assurance</span> <span class="pre">EV</span> <span class="pre">Root</span> <span class="pre">CA</span></code></p></li>
</ul>
<p>We see later down the output of <code class="docutils literal notranslate"><span class="pre">openssl</span> <span class="pre">s_client</span></code> lines like</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span> 0 s:/C=US/ST=California/L=San Francisco/O=GitHub, Inc./CN=github.com
   i:/C=US/O=DigiCert Inc/OU=www.digicert.com/CN=DigiCert SHA2 High Assurance Server CA
</pre></div>
</div>
<p>This indicates the subject (<code class="docutils literal notranslate"><span class="pre">s</span></code>) “Distinguished Name” and the issuer (<code class="docutils literal notranslate"><span class="pre">i</span></code>)
Distinguished Name. Every entry in the chain points to its
issuer, i.e. so we can make our way back up the chain. For <strong>roots</strong>, the
expectation is that the issuer is equal to the subject; we usually refer to
such certificates as “self-signed”.</p>
</div>
<div class="section" id="leaf">
<h2><a class="toc-backref" href="#id3">Leaf</a><a class="headerlink" href="#leaf" title="Permalink to this headline">¶</a></h2>
<p>The leaf certificate is the only one actually controlled by the server.
The server needs to <strong>prove</strong> that it owns the private key corresponding to
the public certificate by providing a signature that can be verified with the
public key. (The public key is stored as part of a public certificate.)</p>
<p>To see the full complement of metadata present in a certificate, we again
turn to the <code class="docutils literal notranslate"><span class="pre">openssl</span></code> command line tool:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ cat ./docs/tls-certs/github-dot-com.pem
-----BEGIN CERTIFICATE-----
MIIG1TCCBb2gAwIBAgIQBVfICygmg6F7ChFEkylreTANBgkqhkiG9w0BAQsFADBw
...
Pb8YGQ6o/blejFzo/OSiUnDueafSJ0p6SQ==
-----END CERTIFICATE-----
$
$ openssl x509 -noout -text -in ./docs/tls-certs/github-dot-com.pem
Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number:
            05:57:c8:0b:28:26:83:a1:7b:0a:11:44:93:29:6b:79
    Signature Algorithm: sha256WithRSAEncryption
        Issuer: C=US, O=DigiCert Inc, OU=www.digicert.com, CN=DigiCert SHA2 High Assurance Server CA
        Validity
            Not Before: May  5 00:00:00 2020 GMT
            Not After : May 10 12:00:00 2022 GMT
        Subject: C=US, ST=California, L=San Francisco, O=GitHub, Inc., CN=github.com
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
                Public-Key: (2048 bit)
                Modulus:
                    00:bb:32:b4:d0:d8:9e:9a:9e:8c:79:29:4c:2b:a8:
                    ef:5c:43:d4:93:3b:94:78:ff:30:54:c7:1b:c8:e5:
                    2f:1b:99:cd:10:8d:67:c8:54:0c:07:5a:e4:f4:06:
                    7f:c7:d6:84:b4:2c:cd:2d:4e:44:26:01:1a:ea:37:
                    be:ef:f4:c7:15:07:c3:16:4c:6b:26:19:09:d2:ff:
                    59:10:44:5b:8a:89:81:94:1d:fe:e2:5f:9a:5f:8a:
                    36:d8:b0:e9:1f:6f:80:22:54:ac:ac:29:43:55:52:
                    d8:15:be:92:68:7b:94:56:51:18:d0:a7:d5:c3:5a:
                    47:a8:d8:3c:c6:1d:72:dc:04:36:9d:ac:cf:15:2c:
                    2e:87:d7:f0:fd:49:77:55:ae:ec:4a:a9:db:8b:29:
                    1e:35:67:fe:9d:95:20:dd:79:8d:60:0a:78:73:dc:
                    28:75:a5:86:df:31:fb:13:09:36:a6:c3:e0:2d:46:
                    dc:25:2b:76:f6:ad:f4:c7:7d:f8:68:c2:3b:b3:33:
                    5e:54:2a:df:9b:ae:bf:dc:10:19:40:8d:04:ef:6b:
                    ca:ee:b5:85:3d:2b:d3:8d:82:5f:a9:1b:6b:bb:06:
                    fe:75:e8:3c:26:37:2f:31:cf:dc:0e:8d:37:8e:a5:
                    e8:74:33:d3:7f:7b:0a:bc:72:06:d1:f3:b2:c5:6b:
                    18:b5
                Exponent: 65537 (0x10001)
        X509v3 extensions:
            X509v3 Authority Key Identifier:
                keyid:51:68:FF:90:AF:02:07:75:3C:CC:D9:65:64:62:A2:12:B8:59:72:3B

            X509v3 Subject Key Identifier:
                63:02:D2:5D:02:5F:F7:8D:D5:5A:12:9E:76:11:36:96:86:2C:8A:48
            X509v3 Subject Alternative Name:
                DNS:github.com, DNS:www.github.com
            X509v3 Key Usage: critical
                Digital Signature, Key Encipherment
            X509v3 Extended Key Usage:
                TLS Web Server Authentication, TLS Web Client Authentication
            X509v3 CRL Distribution Points:

                Full Name:
                  URI:http://crl3.digicert.com/sha2-ha-server-g6.crl

                Full Name:
                  URI:http://crl4.digicert.com/sha2-ha-server-g6.crl

            X509v3 Certificate Policies:
                Policy: 2.16.840.1.114412.1.1
                  CPS: https://www.digicert.com/CPS
                Policy: 2.23.140.1.2.2

            Authority Information Access:
                OCSP - URI:http://ocsp.digicert.com
                CA Issuers - URI:http://cacerts.digicert.com/DigiCertSHA2HighAssuranceServerCA.crt

            X509v3 Basic Constraints: critical
                CA:FALSE
            1.3.6.1.4.1.11129.2.4.2:
                ...h.f.u.)y...99!.Vs.c.w..W}.`
.`..D&#39;*.T.X.g.J.!..I1...qXV...X.q.d .hx..z.R...6.p\n......q.[i......F0D. .~]..P8.........2......0^.....#.. $.:y.PT]...%..T.R(!..)q.....(.#^.v.Q.....y.Vm.7x...z..&#39;....B.
    Signature Algorithm: sha256WithRSAEncryption
         86:32:8f:9c:15:b8:af:e8:d1:de:08:3a:44:0e:71:20:24:d6:
         fc:0e:58:31:cc:aa:b4:ad:1c:d5:0c:c5:af:c4:bb:fe:5f:ac:
         90:6a:42:c8:21:eb:25:f1:6b:2c:37:b2:2a:a8:1a:6e:f2:d1:
         4f:a6:2f:bc:cf:3a:d8:c1:9f:30:c0:ec:93:eb:0a:5a:dc:cb:
         6c:32:1c:60:6e:ec:6e:f8:86:a5:4f:a0:b4:6d:6a:07:4a:21:
         58:d0:29:7d:65:8a:c8:da:6a:ba:ab:f0:75:21:33:00:40:6f:
         85:c5:13:e6:27:73:6c:ae:ea:e3:96:d0:53:db:c1:21:68:10:
         cf:e3:d8:50:b0:14:ec:a9:98:cf:b8:ce:61:5d:3d:a3:6d:93:
         34:c4:13:fa:11:66:a3:dd:be:10:19:70:49:e2:04:4d:81:2c:
         1f:2e:59:c6:2c:53:45:3b:ee:f6:13:f4:d0:2c:84:6e:28:6d:
         e4:e4:ca:e4:48:89:1b:ab:ec:22:1f:ee:12:d4:6c:75:e9:cc:
         0b:15:74:e9:6d:9f:db:40:1f:e2:24:85:a3:4b:a4:e9:cd:6b:
         c8:77:9f:87:4f:05:73:00:38:a5:23:54:68:fc:a2:3d:bf:18:
         19:0e:a8:fd:b9:5e:8c:5c:e8:fc:e4:a2:52:70:ee:79:a7:d2:
         27:4a:7a:49
</pre></div>
</div>
<p>Some things to zoom in on here are subject, issuer and dates relevant to
expiration:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>...
        Issuer: C=US, O=DigiCert Inc, OU=www.digicert.com, CN=DigiCert SHA2 High Assurance Server CA
        Validity
            Not Before: May  5 00:00:00 2020 GMT
            Not After : May 10 12:00:00 2022 GMT
        Subject: C=US, ST=California, L=San Francisco, O=GitHub, Inc., CN=github.com
...
</pre></div>
</div>
<p>as well as X509v3 metadata indicating what the certificate can be used for</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>...
            X509v3 Subject Alternative Name:
                DNS:github.com, DNS:www.github.com
...
            X509v3 Extended Key Usage:
                TLS Web Server Authentication, TLS Web Client Authentication
...
</pre></div>
</div>
<p>These indicate that a certificate authority that <strong>we trust</strong> has deemed this
leaf certificate able to represent the DNS names <code class="docutils literal notranslate"><span class="pre">github.com</span></code> and
<code class="docutils literal notranslate"><span class="pre">www.github.com</span></code> and can be used both as a TLS server certificate and a TLS
client certificate.</p>
</div>
<div class="section" id="intermediate">
<h2><a class="toc-backref" href="#id4">Intermediate</a><a class="headerlink" href="#intermediate" title="Permalink to this headline">¶</a></h2>
<p>As we saw in the <code class="docutils literal notranslate"><span class="pre">openssl</span> <span class="pre">s_client</span></code> output, the intermediate certificate was
also presented by the server:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ cat ./docs/tls-certs/DigiCert-SHA2-High-Assurance-Server-CA.pem
-----BEGIN CERTIFICATE-----
MIIEsTCCA5mgAwIBAgIQBOHnpNxc8vNtwCtCuF0VnzANBgkqhkiG9w0BAQsFADBs
...
cPUeybQ=
-----END CERTIFICATE-----
$
$ openssl x509 -noout -text -in ./docs/tls-certs/DigiCert-SHA2-High-Assurance-Server-CA.pem
...
        Issuer: C=US, O=DigiCert Inc, OU=www.digicert.com, CN=DigiCert High Assurance EV Root CA
        Validity
            Not Before: Oct 22 12:00:00 2013 GMT
            Not After : Oct 22 12:00:00 2028 GMT
        Subject: C=US, O=DigiCert Inc, OU=www.digicert.com, CN=DigiCert SHA2 High Assurance Server CA
...
        X509v3 extensions:
            X509v3 Basic Constraints: critical
                CA:TRUE, pathlen:0
            X509v3 Key Usage: critical
                Digital Signature, Certificate Sign, CRL Sign
            X509v3 Extended Key Usage:
                TLS Web Server Authentication, TLS Web Client Authentication
..
</pre></div>
</div>
<p>In particular note that this certificate is valid for 15 years, as opposed to
the leaf certificate which was only valid for 2 years. Additionally, the
<code class="docutils literal notranslate"><span class="pre">CA:TRUE,</span> <span class="pre">pathlen:0</span></code> part means that we can trust this certificate to be used
as a CA (an intermediate CA), but <code class="docutils literal notranslate"><span class="pre">pathlen:0</span></code> means it can <strong>only</strong> sign leaf
certificates, i.e. it can’t create a child CA.</p>
</div>
<div class="section" id="root">
<h2><a class="toc-backref" href="#id5">Root</a><a class="headerlink" href="#root" title="Permalink to this headline">¶</a></h2>
<p>Where is the root? It’s fairly common practice for servers to <strong>minimize</strong> the
amount of data they need to send by omitting the root CA from the set of
certificates they present. This is because we already have the <strong>full</strong>
expectation that the client will trust the root CA, hence the client should
already possess the root CA certificate.</p>
<img alt="Export from Keychain Access" class="align-center" src="_images/keychain-access02.png" />
<img alt="Save as PEM from Keychain Access" class="align-center" src="_images/keychain-access03.png" />
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ cat ./docs/tls-certs/DigiCert-High-Assurance-EV-Root-CA.pem
-----BEGIN CERTIFICATE-----
MIIDxTCCAq2gAwIBAgIQAqxcJmoLQJuPC3nyrkYldzANBgkqhkiG9w0BAQUFADBs
...
+OkuE6N36B9K
-----END CERTIFICATE-----
$
$ openssl x509 -noout -text -in ./docs/tls-certs/DigiCert-High-Assurance-EV-Root-CA.pem
...
        Issuer: C=US, O=DigiCert Inc, OU=www.digicert.com, CN=DigiCert High Assurance EV Root CA
        Validity
            Not Before: Nov 10 00:00:00 2006 GMT
            Not After : Nov 10 00:00:00 2031 GMT
        Subject: C=US, O=DigiCert Inc, OU=www.digicert.com, CN=DigiCert High Assurance EV Root CA
...
        X509v3 extensions:
            X509v3 Key Usage: critical
                Digital Signature, Certificate Sign, CRL Sign
            X509v3 Basic Constraints: critical
                CA:TRUE
...
</pre></div>
</div>
<p>This certificate is valid for 25 years, as opposed to 15 years for the
intermediate.</p>
</div>
<div class="section" id="links-in-the-chain">
<h2><a class="toc-backref" href="#id6">Links in the Chain</a><a class="headerlink" href="#links-in-the-chain" title="Permalink to this headline">¶</a></h2>
<p>Just presenting the <code class="docutils literal notranslate"><span class="pre">Issuer</span></code> isn’t enough to cryptographically <strong>prove</strong>
that each link in the chain is legitimate. How can we verify each link?</p>
<p>First, ensure the intermediate was issued by the root</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ openssl verify \
&gt;   -verbose \
&gt;   -CAfile ./docs/tls-certs/DigiCert-High-Assurance-EV-Root-CA.pem \
&gt;   ./docs/tls-certs/DigiCert-SHA2-High-Assurance-Server-CA.pem
./docs/tls-certs/DigiCert-SHA2-High-Assurance-Server-CA.pem: OK
</pre></div>
</div>
<p>We can also just omit the <code class="docutils literal notranslate"><span class="pre">-CAfile</span></code> flag because the intermediate has been
signed by a system root:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ openssl verify \
&gt;   -verbose \
&gt;   ./docs/tls-certs/DigiCert-SHA2-High-Assurance-Server-CA.pem
./docs/tls-certs/DigiCert-SHA2-High-Assurance-Server-CA.pem: OK
</pre></div>
</div>
<p>Using the same <code class="docutils literal notranslate"><span class="pre">openssl</span> <span class="pre">verify</span></code> command, can we verify the leaf?</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ openssl verify \
&gt;   -verbose \
&gt;   ./docs/tls-certs/github-dot-com.pem
./docs/tls-certs/github-dot-com.pem: C = US, ST = California, L = San Francisco, O = &quot;GitHub, Inc.&quot;, CN = github.com
error 20 at 0 depth lookup:unable to get local issuer certificate
$
$
$ openssl verify \
&gt;   -verbose \
&gt;   -CAfile ./docs/tls-certs/DigiCert-SHA2-High-Assurance-Server-CA.pem \
&gt;   ./docs/tls-certs/github-dot-com.pem
./docs/tls-certs/github-dot-com.pem: C = US, O = DigiCert Inc, OU = www.digicert.com, CN = DigiCert SHA2 High Assurance Server CA
error 2 at 1 depth lookup:unable to get issuer certificate
</pre></div>
</div>
<p>This first <code class="docutils literal notranslate"><span class="pre">local</span> <span class="pre">issuer</span></code> failure indicates that the leaf’s issuer is not
known to <code class="docutils literal notranslate"><span class="pre">openssl</span></code>. The second <code class="docutils literal notranslate"><span class="pre">issuer</span></code> failure indicates that the
intermediate’s issuer is not known to <code class="docutils literal notranslate"><span class="pre">openssl</span></code>. The second error is a bit
subtle. Since we’ve specified <code class="docutils literal notranslate"><span class="pre">-CAfile</span></code> as an override for the system
root store, the root is no longer part of this verify command. From the
<a class="reference external" href="https://www.openssl.org/docs/man1.0.2/man1/openssl-verify.html">docs</a>:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>   -CAfile: A file of trusted certificates. The file should contain multiple
            certificates in PEM format concatenated together.

-untrusted: A file of untrusted certificates. The file should contain multiple
            certificates in PEM format concatenated together.
</pre></div>
</div>
<p>So we actually need to specify the intermediate in the set of “extra” untrusted
certificates:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ openssl verify \
&gt;   -verbose \
&gt;   -untrusted ./docs/tls-certs/DigiCert-SHA2-High-Assurance-Server-CA.pem \
&gt;   ./docs/tls-certs/github-dot-com.pem
./docs/tls-certs/github-dot-com.pem: OK
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="wireshark.html" class="btn btn-neutral float-right" title="Wireshark Tooling" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="introduction.html" class="btn btn-neutral float-left" title="Introduction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, Danny Hermes a397c8ae.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>